<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>ROS学习笔记二_通信机制 | 苛苛浩</title><meta name="keywords" content="ROS"><meta name="author" content="Bohao Zhao"><meta name="copyright" content="Bohao Zhao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="ROS学习笔记二_通信机制"><meta name="application-name" content="ROS学习笔记二_通信机制"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="ROS学习笔记二_通信机制"><meta property="og:url" content="https://bohaoblog.top/posts/4d8d4c8f.html"><meta property="og:site_name" content="苛苛浩"><meta property="og:description" content="ROS 通信机制  ROS 中的基本通信机制主要有如下三种实现策略:  话题通信(发布订阅模式) 服务通信(请求响应模式) 参数服务器(参数共享模式)   话题通信 话题通信是ROS中使用频率最高的一种通信模式，话题通信是基于发布订阅模式的，也即:一个节点发布消息，另一个节点订阅"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img@main/01%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%9E%8B.jpg"><meta property="article:author" content="Bohao Zhao"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img@main/01%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%9E%8B.jpg"><meta name="description" content="ROS 通信机制  ROS 中的基本通信机制主要有如下三种实现策略:  话题通信(发布订阅模式) 服务通信(请求响应模式) 参数服务器(参数共享模式)   话题通信 话题通信是ROS中使用频率最高的一种通信模式，话题通信是基于发布订阅模式的，也即:一个节点发布消息，另一个节点订阅"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img/202504152018373.svg"><link rel="canonical" href="https://bohaoblog.top/posts/4d8d4c8f.html"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="r25jfaG9j7XVS5-THRRmTF8Wkrnd4HSKXjk7J6cxotY"/><meta name="baidu-site-verification" content="codeva-zHMvbLEKpV"/><meta name="msvalidate.01" content="BC8842521ACA54970C4D7CD73A924D04"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"X﹏X 页面丢失！请重新加载~","backTitle":"♪(^∇^*)骗你哒！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://twikoo.bohaoblog.top',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🔍 小小研究牲","🔨 喜欢动动小手","🤝 友好助人","🏃 行动派"]},
  algolia: {"appId":"9EOFLVIU93","apiKey":"17b07b0a351f61ea3b363b2410ea5738","indexName":"Hexo","hits":{"per_page":8},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":500},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Bohao Zhao","link":"链接: ","source":"来源: 苛苛浩","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '苛苛浩',
  title: 'ROS学习笔记二_通信机制',
  postAI: '',
  pageFillDescription: 'ROS 通信机制, 话题通信, 概念, 作用, 理论模型, 话题通信基本操作, 发布者代码实现, 订阅方, 配置CMakeList.text, 通信msg文件, 定义msg文件, 编辑配置文件, 编译, 服务通信, 理论模型, 服务srv文件, 定义srv文件, 编辑配置文件, 编译, 服务通信基本操作, 服务端, 客户端, 配置 CMakeLists.txt, 执行, 参数服务器, 理论模型, 参数可使用数据类型, 参数服务器基本操作, 参数服务器新增(修改)参数, 参数服务器获取参数, 参数服务器删除参数, 通信机制比较通信机制中的基本通信机制主要有如下三种实现策略话题通信发布订阅模式服务通信请求响应模式参数服务器参数共享模式话题通信话题通信是中使用频率最高的一种通信模式话题通信是基于发布订阅模式的也即一个节点发布消息另一个节点订阅该消息话题通信的应用场景也极其广泛比如下面一个常见场景机器人在执行导航功能使用的传感器是激光雷达机器人会采集激光雷达感知到的信息并计算然后生成运动控制信息驱动机器人底盘运动在上述场景中就不止一次使用到了话题通信以激光雷达信息的采集处理为例在中有一个节点需要实时地发布当前雷达采集到的数据导航模块中也有节点会订阅并解析雷达数据再以运动消息的发布为例导航模块会根据传感器采集的数据时时的计算出运动控制信息并发布给底盘底盘也可以有一个节点订阅运动信息并最终转换成控制电机的脉冲信号以此类推像雷达摄像头等等一些传感器数据的采集也都是使用了话题通信换言之话题通信适用于不断更新的数据传输相关的应用场景概念以发布订阅的方式实现不同节点之间数据交互的通信模式作用用于不断更新的少逻辑处理的数据传输场景理论模型话题通信模型如下图所示管理者发布者订阅者负责保管和注册的信息并匹配话题相同的与帮助与建立连接连接建立后可以发布消息且发布的消息会被订阅整个流程由以下步骤实现注册启动后会通过远程过程调用协议在中注册自身信息其中包含所发布消息的话题名称会将节点的注册信息加入到注册表中注册启动后也会通过在中注册自身信息包含需要订阅消息的话题名会将节点的注册信息加入到注册表中实现信息匹配会根据注册表中的信息匹配和并通过向发送的地址信息向发送请求根据接收到的地址通过向发送连接请求传输订阅的话题名称消息类型以及通信协议确认请求接收到的请求后也是通过向确认连接信息并发送自身的地址信息与件里连接根据步骤返回的消息使用与建立网络连接向发送消息连接建立后开始向发布消息注意上述实现流程中前五步使用的协议最后两步使用的是协议注意与的启动无先后顺序要求注意与都可以有多个注意与连接建立后不再需要也即即便关闭与照常通信即在启动节点后可以关闭终端话题通信基本操作发布者代码实现需求实现基本的话题通信一方发布数据一方接收数据实现的关键点发送方接收方数据此处为普通文本二者需要设置相同的话题消息发布方循环发布信息后缀数字编号实现流程包含头文件初始化节点命名唯一实例化句柄实例化发布者对象组织被发布的数据并编写逻辑发布数据包含头文件普通文本类型的消息设置中文编码初始化节点将当前程序注册为节点命名为参数和参数后期为节点传值会使用参数是节点名称是一个标识符需要保证运行后在网络拓扑中唯一实例化句柄该类封装了中的一些常用功能实例化发布者对象泛型发布的消息类型参数要发布到的话题参数队列中最大保存消息数超出此阀值时先进的先销毁时间早的先销毁组织被发布的数据并编写逻辑发布数据数据动态组织你好啊你好消息前缀消息计数器逻辑一秒次节点不死使用拼接字符串与编号发布消息加入调试打印发送的消息发送的消息根据前面制定的发送贫频率自动休眠休眠时间频率循环结束前让自增暂无应用订阅方需求实现基本的话题通信一方发布数据一方接收数据实现的关键点发送方接收方数据此处为普通文本消息订阅方订阅话题并打印接收到的消息实现流程包含头文件初始化节点命名唯一实例化句柄实例化订阅者对象处理订阅的消息回调函数设置循环调用回调函数包含头文件我听见我听见初始化节点命名唯一实例化句柄实例化订阅者对象处理订阅的消息回调函数设置循环调用回调函数循环读取接收的数据并调用回调函数处理配置通信文件在通信协议中数据载体是一个较为重要组成部分中通过封装了一些原生的数据类型比如但是这些数据一般只包含一个字段结构的单一意味着功能上的局限性当传输一些复杂的数据比如激光雷达的信息由于描述性较差而显得力不从心这种场景下可以使用自定义的消息类型需求创建自定义消息该消息包含人的信息姓名身高年龄等流程按照固定格式创建文件编辑配置文件编译生成可以被或调用的中间文件定义文件功能包下新建目录添加文件编辑配置文件中添加编译依赖与执行依赖以前对应的是现在非法编辑相关配置需要加入必须有配置源文件生成消息时依赖于执行时依赖编译编译后的中间文件查看需要调用的中间文件工作空间包名需要调用的中间文件工作空间包名后续调用相关时是从这些中间文件调用的服务通信服务通信较之于话题通信更简单些理论模型如下图所示该模型中涉及到三个角色管理者服务端客户端理论模型负责保管和注册的信息并匹配话题相同的与帮助与建立连接连接建立后发送请求信息返回响应信息整个流程由以下步骤实现注册启动后会通过在中注册自身信息其中包含提供的服务的名称会将节点的注册信息加入到注册表中注册启动后也会通过在中注册自身信息包含需要请求的服务的名称会将节点的注册信息加入到注册表中实现信息匹配会根据注册表中的信息匹配和并通过向发送的地址信息发送请求根据步骤响应的信息使用与建立网络连接并发送请求数据发送响应接收解析请求的数据并产生响应结果返回给注意客户端请求被处理时需要保证服务器已经启动服务端和客户端都可以存在多个服务文件定义文件服务通信中数据分成两部分请求与响应在文件中请求和响应使用分割具体实现如下功能包下新建目录添加文件内容客户端请求时发送的两个数字服务器响应发送的数据编辑配置文件配置几乎与话题一致中添加编译依赖与执行依赖以前对应的是现在非法编辑相关配置需要加入必须有注意官网没有在中配置经测试配置也可以编译编译后的中间文件查看需要调用的中间文件工作空间包名需要调用的中间文件工作空间包名后续调用相关时是从这些中间文件调用的服务通信基本操作服务端需求编写两个节点实现服务通信客户端节点需要提交两个整数到服务器服务器需要解析客户端提交的数据相加后将结果响应回客户端客户端再解析服务器实现包含头文件初始化节点创建句柄创建服务对象回调函数处理请求并产生响应由于请求有多个需要调用返回值由于标志是否处理成功服务器接收到的请求数据为逻辑处理提交的数据异常数据不可以为负数如果没有异常那么相加并将结果赋值给初始化节点创建句柄创建服务对象服务已经启动回调函数处理请求并产生响应由于请求有多个需要调用客户端需求编写两个节点实现服务通信客户端节点需要提交两个整数到服务器服务器需要解析客户端提交的数据相加后将结果响应回客户端客户端再解析服务器实现包含头文件初始化节点创建句柄创建客户端对象请求服务接收响应包含头文件调用时动态传值如果通过的传参需要传递的参数个数传参文件路径传入的参数传入的参数节点名称日志路径请提交两个整数初始化节点创建句柄创建客户端对象等待服务启动成功方式方式组织请求数据发送请求返回值标记是否成功处理响应请求正常处理响应结果请求处理失败配置执行流程需要先启动服务包名服务然后再调用客户端包名客户端参数参数结果会根据提交的数据响应相加后的结果注意如果先启动客户端那么会导致运行失败优化在客户端发送请求前添加或这是一个阻塞式函数只有服务启动成功后才会继续执行此处可以使用文件优化但是需要注意传参特点参数服务器参数服务器实现是最为简单的该模型如下图所示该模型中涉及到三个角色管理者参数设置者参数调用者理论模型作为一个公共容器保存参数可以向容器中设置参数可以获取参数整个流程由以下步骤实现设置参数通过向参数服务器发送参数包括参数名与参数值将参数保存到参数列表中获取参数通过向参数服务器发送参数查找请求请求中包含要查找的参数名向发送参数值根据步骤请求提供的参数名查找参数值并将查询结果通过发送给参数可使用数据类型字典注意参数服务器不是为高性能而设计的因此最好用于存储静态的非二进制的简单数据参数服务器基本操作需求实现参数服务器参数的增删改查操作在中实现参数服务器数据的增删改查可以通过两套实现参数服务器新增修改参数参数服务器操作之新增与修改二者一样实现在中提供了两套实现参数操作键值键值示例分别设置整形浮点字符串列表字典等类型参数修改相同的键不同的值李四王五孙大脑袋整型浮点型字符串修改演示相同的键不同的值修改演示相同的键不同的值参数服务器获取参数参数服务器操作之查询实现在中提供了两套实现参数操作键默认值存在返回对应结果否则返回默认值键存储结果的变量存在返回且将值赋值给参数若果键不存在那么返回值为且不为参数赋值键存储结果的变量提高变量获取效率存在返回且将值赋值给参数若果键不存在那么返回值为且不为参数赋值获取所有的键并存储在参数中键是否包含某个键存在返回否则返回参数参数搜索键参数是被搜索的键参数存储搜索结果的变量与类似函数键存在键不存在获取结果函数获取的结果元素元素通过缓存获取数据名称解析存在吗存在吗搜索键存在不存在返回默认获取结果函数获取的结果元素元素通过缓存获取数据名称解析存在吗存在吗搜索键参数服务器删除参数参数服务器操作之删除实现键根据键删除参数删除成功返回否则参数不存在返回键根据键删除参数删除成功返回否则参数不存在返回删除结果删除结果通信机制比较三种通信机制中参数服务器是一种数据共享机制可以在不同的节点之间共享数据话题通信与服务通信是在不同的节点之间传递数据的三者是中最基础也是应用最为广泛的通信机制这其中话题通信和服务通信有一定的相似性也有本质上的差异在此将二者做一下简单比较二者的实现流程是比较相似的都是涉及到四个要素要素消息的发布方客户端要素消息的订阅方服务端要素话题名称要素数据载体可以概括为两个节点通过话题关联到一起并使用某种类型的数据载体实现数据传输二者的实现也是有本质差异的具体比较如下话题服务通信模式发布订阅请求响应同步性异步同步底层协议缓冲区有无实时性弱强节点关系多对多一对多一个通信数据使用场景连续高频的数据发布与接收雷达里程计偶尔调用或执行某一项特定功能拍照语音识别不同通信机制有一定的互补性都有各自适应的应用场景尤其是话题与服务通信需要结合具体的应用场景与二者的差异选择合适的通信机制',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-07-28 22:43:41',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/custom/css/custom.css"<meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/atom.xml" title="苛苛浩" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://bohaoblog.top/" title="个人主页"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="个人主页"/><span class="back-menu-item-text">个人主页</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">苛苛浩</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img/202504161847401.jpg" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img/202504161847401.jpg"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img/202504161847176.jpg" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img/202504161847176.jpg"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CMake/" style="font-size: 1.05rem;">CMake<sup>1</sup></a><a href="/tags/IEEE/" style="font-size: 1.05rem;">IEEE<sup>1</sup></a><a href="/tags/latex/" style="font-size: 1.05rem;">latex<sup>1</sup></a><a href="/tags/%E5%80%BC%E5%87%BD%E6%95%B0%E8%BF%91%E4%BC%BC%E5%92%8CDQN/" style="font-size: 1.05rem;">值函数近似和DQN<sup>1</sup></a><a href="/tags/%E5%80%BC%E8%BF%AD%E4%BB%A3%E5%92%8C%E7%AD%96%E7%95%A5%E8%BF%AD%E4%BB%A3/" style="font-size: 1.05rem;">值迭代和策略迭代<sup>1</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E5%8E%9F%E7%90%86/" style="font-size: 1.05rem;">基础原理<sup>1</sup></a><a href="/tags/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0-%E6%9C%BA%E5%99%A8%E4%BA%BA-ROS/" style="font-size: 1.05rem;">强化学习 机器人 ROS<sup>1</sup></a><a href="/tags/%E6%8E%A7%E5%88%B6%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">控制算法<sup>1</sup></a><a href="/tags/%E6%96%87%E6%9C%AC/" style="font-size: 1.05rem;">文本<sup>1</sup></a><a href="/tags/%E6%96%87%E7%8C%AE%E7%AE%A1%E7%90%86/" style="font-size: 1.05rem;">文献管理<sup>2</sup></a><a href="/tags/%E6%97%B6%E5%BA%8F%E5%B7%AE%E5%88%86%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">时序差分算法<sup>1</sup></a><a href="/tags/%E6%9C%BA%E5%99%A8%E4%BA%BA/" style="font-size: 1.05rem;">机器人<sup>1</sup></a><a href="/tags/%E6%9C%BA%E5%99%A8%E4%BA%BA-ROS/" style="font-size: 1.05rem;">机器人 ROS<sup>3</sup></a><a href="/tags/%E6%BC%94%E5%91%98%E8%AF%84%E8%AE%BA%E5%AE%B6%E6%96%B9%E6%B3%95/" style="font-size: 1.05rem;">演员评论家方法<sup>1</sup></a><a href="/tags/%E7%AD%89%E4%BB%B7%E8%BE%93%E5%85%A5%E5%B9%B2%E6%89%B0/" style="font-size: 1.05rem;">等价输入干扰<sup>2</sup></a><a href="/tags/%E7%AD%96%E7%95%A5%E6%A2%AF%E5%BA%A6%E6%96%B9%E6%B3%95/" style="font-size: 1.05rem;">策略梯度方法<sup>1</sup></a><a href="/tags/%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E6%96%B9%E6%B3%95/" style="font-size: 1.05rem;">蒙特卡洛方法<sup>1</sup></a><a href="/tags/%E8%B4%9D%E5%B0%94%E6%9B%BC%E6%96%B9%E7%A8%8B/" style="font-size: 1.05rem;">贝尔曼方程<sup>1</sup></a><a href="/tags/%E8%B4%9D%E5%B0%94%E6%9B%BC%E6%9C%80%E4%BC%98%E6%96%B9%E7%A8%8B/" style="font-size: 1.05rem;">贝尔曼最优方程<sup>1</sup></a><a href="/tags/%E9%9A%8F%E6%9C%BA%E8%BF%91%E4%BC%BC%E7%90%86%E8%AE%BA%E5%92%8C%E9%9A%8F%E6%9C%BA%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D/" style="font-size: 1.05rem;">随机近似理论和随机梯度下降<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">九月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" itemprop="url">机器人操作系统</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E6%9C%BA%E5%99%A8%E4%BA%BA-ROS/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>机器人 ROS</span></a></span></div></div><h1 class="post-title" itemprop="name headline">ROS学习笔记二_通信机制</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-07-28T14:37:36.000Z" title="发表于 2025-07-28 22:37:36">2025-07-28</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-07-28T14:43:41.775Z" title="更新于 2025-07-28 22:43:41">2025-07-28</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">5.4k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>20分钟</span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为北京"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>北京</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img@main/01%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%9E%8B.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://bohaoblog.top/posts/4d8d4c8f.html"><header><a class="post-meta-categories" href="/categories/%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" itemprop="url">机器人操作系统</a><a href="/tags/%E6%9C%BA%E5%99%A8%E4%BA%BA-ROS/" tabindex="-1" itemprop="url">机器人 ROS</a><h1 id="CrawlerTitle" itemprop="name headline">ROS学习笔记二_通信机制</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Bohao Zhao</span><time itemprop="dateCreated datePublished" datetime="2025-07-28T14:37:36.000Z" title="发表于 2025-07-28 22:37:36">2025-07-28</time><time itemprop="dateCreated datePublished" datetime="2025-07-28T14:43:41.775Z" title="更新于 2025-07-28 22:43:41">2025-07-28</time></header><h1 id="ros-通信机制">ROS 通信机制</h1>
<hr>
<p>ROS 中的基本通信机制主要有如下三种实现策略:</p>
<ul>
<li>话题通信(发布订阅模式)</li>
<li>服务通信(请求响应模式)</li>
<li>参数服务器(参数共享模式)</li>
</ul>
<hr>
<h2 id="话题通信">话题通信</h2>
<p>话题通信是ROS中使用频率最高的一种通信模式，话题通信是基于<strong>发布订阅</strong>模式的，也即:一个节点发布消息，另一个节点订阅该消息。话题通信的应用场景也极其广泛，比如下面一个常见场景:</p>
<blockquote>
<p>机器人在执行<strong>导航功能</strong>，使用的传感器是<strong>激光雷达</strong>，机器人会<strong>采集</strong>激光雷达感知到的信息并计算，然后<strong>生成</strong>运动控制信息<strong>驱动</strong>机器人底盘运动。</p>
</blockquote>
<p>在上述场景中，就不止一次使用到了话题通信。</p>
<ul>
<li>以激光雷达信息的采集处理为例，在 ROS
中有一个节点需要实时地发布当前雷达采集到的数据，导航模块中也有节点会订阅并解析雷达数据。</li>
<li>再以运动消息的发布为例，导航模块会根据传感器采集的数据时时的计算出运动控制信息并发布给底盘，底盘也可以有一个节点订阅运动信息并最终转换成控制电机的脉冲信号。</li>
</ul>
<p>以此类推，像雷达、摄像头、GPS….
等等一些传感器数据的采集，也都是使用了话题通信，换言之，话题通信适用于不断更新的数据传输相关的应用场景。</p>
<h3 id="概念"><strong>概念</strong></h3>
<p>以发布订阅的方式实现不同节点之间数据交互的通信模式。</p>
<h3 id="作用"><strong>作用</strong></h3>
<p>用于不断更新的、少逻辑处理的数据传输场景。</p>
<h3 id="理论模型">理论模型</h3>
<p>话题通信模型如下图所示</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img@main/01%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%9E%8B.jpg" alt="img" style="zoom:50%;">

<ul>
<li>ROS Master (管理者)</li>
<li>Talker (发布者)</li>
<li>Listener (订阅者)</li>
</ul>
<p>ROS Master 负责保管 Talker 和 Listener 注册的信息，并匹配话题相同的
Talker 与 Listener，帮助 Talker 与 Listener 建立连接，连接建立后，Talker
可以发布消息，且发布的消息会被 Listener 订阅。</p>
<p>整个流程由以下步骤实现:</p>
<ol type="1">
<li><strong>Talker注册</strong>：Talker启动后，会通过远程过程调用协议(Remote
Procedure Call Protocol，RPC)s在 ROS Master
中注册自身信息，其中包含所发布消息的话题名称。ROS Master
会将节点的注册信息加入到注册表中。</li>
<li><strong>Listener注册</strong>：Listener启动后，也会通过RPC在 ROS
Master 中注册自身信息，包含需要订阅消息的话题名。ROS Master
会将节点的注册信息加入到注册表中。</li>
<li><strong>ROS Master实现信息匹配</strong>：ROS Master
会根据注册表中的信息匹配Talker 和 Listener，并通过 RPC 向 Listener 发送
Talker 的 RPC 地址信息。</li>
<li><strong>Listener向Talker发送请求</strong>：Listener 根据接收到的 RPC
地址，通过 RPC 向 Talker
发送连接请求，传输订阅的话题名称、消息类型以及通信协议(TCP/UDP)。</li>
<li><strong>Talker确认请求</strong>：Talker 接收到 Listener
的请求后，也是通过 RPC 向 Listener 确认连接信息，并发送自身的 TCP
地址信息。</li>
<li><strong>Listener与Talker件里连接</strong>：Listener 根据步骤5
返回的消息使用 TCP 与 Talker 建立网络连接。</li>
<li><strong>Talker向Listener发送消息</strong>：连接建立后，Talker 开始向
Listener 发布消息。</li>
</ol>
<blockquote>
<p><strong>注意1</strong>:上述实现流程中，前五步使用的
RPC协议，最后两步使用的是 TCP 协议</p>
<p><strong>注意2</strong>: Talker 与 Listener 的启动无先后顺序要求</p>
<p><strong>注意3</strong>: Talker 与 Listener 都可以有多个</p>
<p><strong>注意4</strong>: Talker 与 Listener 连接建立后，不再需要 ROS
Master。也即，即便关闭ROS Master，Talker 与 Listerner
照常通信，即在启动节点后可以关闭 <code>roscore</code> 终端。</p>
</blockquote>
<h3 id="话题通信基本操作">话题通信基本操作</h3>
<h4 id="发布者代码实现">发布者代码实现</h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    需求: 实现基本的话题通信，一方发布数据，一方接收数据，</span></span><br><span class="line"><span class="comment">         实现的关键点:</span></span><br><span class="line"><span class="comment">         1.发送方</span></span><br><span class="line"><span class="comment">         2.接收方</span></span><br><span class="line"><span class="comment">         3.数据(此处为普通文本)</span></span><br><span class="line"><span class="comment">    PS: 二者需要设置相同的话题</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">消息发布方:</span></span><br><span class="line"><span class="comment">    循环发布信息:HelloWorld 后缀数字编号</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">实现流程:</span></span><br><span class="line"><span class="comment">    1.包含头文件 </span></span><br><span class="line"><span class="comment">    2.初始化 ROS 节点:命名(唯一)</span></span><br><span class="line"><span class="comment">    3.实例化 ROS 句柄</span></span><br><span class="line"><span class="comment">    4.实例化 发布者 对象</span></span><br><span class="line"><span class="comment">    5.组织被发布的数据，并编写逻辑发布数据</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="comment">// 1.包含头文件 </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"std_msgs/String.h"</span> <span class="comment">//普通文本类型的消息</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>  *argv[])</span></span></span><br><span class="line"><span class="function"></span>{   </span><br><span class="line"><span class="comment">// 设置中文编码</span></span><br><span class="line"><span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.初始化 ROS 节点，将当前程序注册为 ROS 节点，命名为 talker</span></span><br><span class="line"><span class="comment">// 参数1和参数2 后期为节点传值会使用</span></span><br><span class="line"><span class="comment">// 参数3 是节点名称，是一个标识符，需要保证运行后，在 ROS 网络拓扑中唯一</span></span><br><span class="line">ros::<span class="built_in">init</span>(argc,argv,<span class="string">"talker"</span>);</span><br><span class="line"><span class="comment">//3.实例化 ROS 句柄</span></span><br><span class="line">ros::NodeHandle nh;<span class="comment">//该类封装了 ROS 中的一些常用功能</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//4.实例化 发布者 对象</span></span><br><span class="line"><span class="comment">//泛型: 发布的消息类型,std_msgs::String</span></span><br><span class="line"><span class="comment">//参数1: 要发布到的话题,chatter</span></span><br><span class="line"><span class="comment">//参数2: 队列中最大保存消息数，超出此阀值时，先进的先销毁(时间早的先销毁),10b</span></span><br><span class="line">ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;std_msgs::String&gt;(<span class="string">"chatter"</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//5.组织被发布的数据，并编写逻辑发布数据</span></span><br><span class="line"><span class="comment">//数据(动态组织)</span></span><br><span class="line">std_msgs::String msg;</span><br><span class="line"><span class="comment">// msg.data = "你好啊！！！";</span></span><br><span class="line">std::string msg_front = <span class="string">"Hello 你好！"</span>; <span class="comment">//消息前缀</span></span><br><span class="line"><span class="type">int</span> count = <span class="number">0</span>; <span class="comment">//消息计数器</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//逻辑(一秒10次)</span></span><br><span class="line"><span class="function">ros::Rate <span class="title">r</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//节点不死</span></span><br><span class="line"><span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">{</span><br><span class="line">    <span class="comment">//使用 stringstream 拼接字符串与编号</span></span><br><span class="line">    std::stringstream ss;</span><br><span class="line">    ss &lt;&lt; msg_front &lt;&lt; count;</span><br><span class="line">    msg.data = ss.<span class="built_in">str</span>();</span><br><span class="line">    <span class="comment">//发布消息</span></span><br><span class="line">    pub.<span class="built_in">publish</span>(msg);</span><br><span class="line">    <span class="comment">//加入调试，打印发送的消息</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"发送的消息:%s"</span>,msg.data.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据前面制定的发送贫频率自动休眠 休眠时间 = 1/频率；</span></span><br><span class="line">    r.<span class="built_in">sleep</span>();</span><br><span class="line">    count++;<span class="comment">//循环结束前，让 count 自增</span></span><br><span class="line">    <span class="comment">//暂无应用</span></span><br><span class="line">    ros::<span class="built_in">spinOnce</span>();</span><br><span class="line">}</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="订阅方">订阅方</h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    需求: 实现基本的话题通信，一方发布数据，一方接收数据，</span></span><br><span class="line"><span class="comment">         实现的关键点:</span></span><br><span class="line"><span class="comment">         1.发送方</span></span><br><span class="line"><span class="comment">         2.接收方</span></span><br><span class="line"><span class="comment">         3.数据(此处为普通文本)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    消息订阅方:</span></span><br><span class="line"><span class="comment">        订阅话题并打印接收到的消息</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    实现流程:</span></span><br><span class="line"><span class="comment">        1.包含头文件 </span></span><br><span class="line"><span class="comment">        2.初始化 ROS 节点:命名(唯一)</span></span><br><span class="line"><span class="comment">        3.实例化 ROS 句柄</span></span><br><span class="line"><span class="comment">        4.实例化 订阅者 对象</span></span><br><span class="line"><span class="comment">        5.处理订阅的消息(回调函数)</span></span><br><span class="line"><span class="comment">        6.设置循环调用回调函数</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 1.包含头文件 </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"std_msgs/String.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doMsg</span><span class="params">(<span class="type">const</span> std_msgs::String::ConstPtr&amp; msg_p)</span></span>{</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"我听见:%s"</span>,msg_p-&gt;data.<span class="built_in">c_str</span>());</span><br><span class="line">    <span class="comment">// ROS_INFO("我听见:%s",(*msg_p).data.c_str());</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>  *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    <span class="comment">//2.初始化 ROS 节点:命名(唯一)</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"listener"</span>);</span><br><span class="line">    <span class="comment">//3.实例化 ROS 句柄</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.实例化 订阅者 对象</span></span><br><span class="line">    ros::Subscriber sub = nh.<span class="built_in">subscribe</span>&lt;std_msgs::String&gt;(<span class="string">"chatter"</span>,<span class="number">10</span>,doMsg);</span><br><span class="line">    <span class="comment">//5.处理订阅的消息(回调函数)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//6.设置循环调用回调函数</span></span><br><span class="line">    ros::<span class="built_in">spin</span>();<span class="comment">//循环读取接收的数据，并调用回调函数处理</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="配置cmakelisttext">配置CMakeList.text</h4>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(Hello_pub</span><br><span class="line">  src/Hello_pub.cpp</span><br><span class="line">)</span><br><span class="line"><span class="keyword">add_executable</span>(Hello_sub</span><br><span class="line">  src/Hello_sub.cpp</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>(Hello_pub</span><br><span class="line">  <span class="variable">${catkin_LIBRARIES}</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(Hello_sub</span><br><span class="line">  <span class="variable">${catkin_LIBRARIES}</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="通信msg文件">通信msg文件</h3>
<p>在 ROS 通信协议中，数据载体是一个较为重要组成部分，ROS 中通过
std_msgs
封装了一些原生的数据类型,比如:String、Int32、Int64、Char、Bool、Empty….
但是，这些数据一般只包含一个 data
字段，结构的单一意味着功能上的局限性，当传输一些复杂的数据，比如:
激光雷达的信息… std_msgs
由于描述性较差而显得力不从心，这种场景下可以使用自定义的消息类型</p>
<p>**需求:**创建自定义消息，该消息包含人的信息:姓名、身高、年龄等。</p>
<p><strong>流程:</strong></p>
<ol type="1">
<li>按照固定格式创建 msg 文件</li>
<li>编辑配置文件</li>
<li>编译生成可以被 Python 或 C++ 调用的中间文件</li>
</ol>
<h4 id="定义msg文件">定义msg文件</h4>
<p>功能包下新建 msg 目录，添加文件 Person.msg</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string name</span><br><span class="line">uint16 age</span><br><span class="line">float64 height</span><br></pre></td></tr></table></figure>

<h4 id="编辑配置文件">编辑配置文件</h4>
<p><strong>package.xml</strong>中添加编译依赖与执行依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>message_generation<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>message_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">exce_depend 以前对应的是 run_depend 现在非法</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>CMakeLists.txt</strong>编辑 msg 相关配置</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(catkin REQUIRED COMPONENTS</span><br><span class="line">  roscpp</span><br><span class="line">  rospy</span><br><span class="line">  std_msgs</span><br><span class="line">  message_generation</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 需要加入 message_generation,必须有 std_msgs</span></span><br><span class="line"><span class="comment">## 配置 msg 源文件</span></span><br><span class="line">add_message_files(</span><br><span class="line">  FILES</span><br><span class="line">  Person.msg</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 生成消息时依赖于 std_msgs</span></span><br><span class="line">generate_messages(</span><br><span class="line">  DEPENDENCIES</span><br><span class="line">  std_msgs</span><br><span class="line">)</span><br><span class="line"><span class="comment">#执行时依赖</span></span><br><span class="line">catkin_package(</span><br><span class="line"><span class="comment">#  INCLUDE_DIRS include</span></span><br><span class="line"><span class="comment">#  LIBRARIES demo02_talker_listener</span></span><br><span class="line">  CATKIN_DEPENDS roscpp rospy std_msgs message_runtime</span><br><span class="line"><span class="comment">#  DEPENDS system_lib</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="编译">编译</h4>
<p><strong>编译后的中间文件查看:</strong></p>
<p>C++ 需要调用的中间文件(…/工作空间/devel/include/包名/xxx.h)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://www.autolabor.com.cn/book/ROSTutorials/assets/05vscode_自定义消息的中间文件%28C++%29.PNG" alt="img"></p>
<p>Python
需要调用的中间文件(…/工作空间/devel/lib/python3/dist-packages/包名/msg)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://www.autolabor.com.cn/book/ROSTutorials/assets/06vscode_自定义消息的中间文件%28Python%29.PNG" alt="img"></p>
<p>后续调用相关 msg 时，是从这些中间文件调用的</p>
<h2 id="服务通信">服务通信</h2>
<p>服务通信较之于话题通信更简单些，理论模型如下图所示，该模型中涉及到三个角色:</p>
<ul>
<li>ROS master(管理者)</li>
<li>Server(服务端)</li>
<li>Client(客户端)</li>
</ul>
<h3 id="理论模型-1">理论模型</h3>
<p>ROS Master 负责保管 Server 和 Client 注册的信息，并匹配话题相同的
Server 与 Client ，帮助 Server 与 Client 建立连接，连接建立后，Client
发送请求信息，Server 返回响应信息。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img@main/02_%E6%9C%8D%E5%8A%A1%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%9E%8B.jpg" alt="img" style="zoom:50%;">

<p>整个流程由以下步骤实现:</p>
<ol type="1">
<li><strong>Server注册</strong> Server 启动后，会通过RPC在 ROS Master
中注册自身信息，其中包含提供的服务的名称。ROS Master
会将节点的注册信息加入到注册表中。</li>
<li><strong>Client注册</strong> Client 启动后，也会通过RPC在 ROS Master
中注册自身信息，包含需要请求的服务的名称。ROS Master
会将节点的注册信息加入到注册表中。</li>
<li><strong>ROS Master实现信息匹配</strong> ROS Master
会根据注册表中的信息匹配Server和 Client，并通过 RPC 向 Client 发送
Server 的 <strong>TCP</strong> 地址信息。</li>
<li><strong>Client发送请求</strong> Client 根据步骤2 响应的信息，使用
TCP 与 Server 建立网络连接，并发送请求数据。</li>
<li><strong>Server发送响应</strong> Server
接收、解析请求的数据，并产生响应结果返回给 Client。</li>
</ol>
<p><strong>注意:</strong></p>
<p>1.客户端请求被处理时，需要保证服务器已经启动；</p>
<p>2.服务端和客户端都可以存在多个。</p>
<h3 id="服务srv文件">服务srv文件</h3>
<h4 id="定义srv文件">定义srv文件</h4>
<p>服务通信中，数据分成两部分，请求与响应，在 srv
文件中请求和响应使用<code>---</code>分割，具体实现如下:</p>
<p>功能包下新建 srv 目录，添加 xxx.srv 文件，内容:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 客户端请求时发送的两个数字</span><br><span class="line">int32 num1</span><br><span class="line">int32 num2</span><br><span class="line">---</span><br><span class="line"># 服务器响应发送的数据</span><br><span class="line">int32 sum</span><br></pre></td></tr></table></figure>

<h4 id="编辑配置文件-1">编辑配置文件</h4>
<p>配置几乎与话题一致</p>
<p><strong>package.xml</strong>中添加编译依赖与执行依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>message_generation<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>message_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">exce_depend 以前对应的是 run_depend 现在非法</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>CMakeLists.txt</strong>编辑 srv 相关配置</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(catkin REQUIRED COMPONENTS</span><br><span class="line">  roscpp</span><br><span class="line">  rospy</span><br><span class="line">  std_msgs</span><br><span class="line">  message_generation</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 需要加入 message_generation,必须有 std_msgs</span></span><br><span class="line">add_service_files(</span><br><span class="line">  FILES</span><br><span class="line">  AddInts.srv</span><br><span class="line">)</span><br><span class="line">generate_messages(</span><br><span class="line">  DEPENDENCIES</span><br><span class="line">  std_msgs</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>注意: 官网没有在 catkin_package 中配置
message_runtime,经测试配置也可以</p>
<h4 id="编译-1">编译</h4>
<p>编译后的中间文件查看:</p>
<p>C++ 需要调用的中间文件(…/工作空间/devel/include/包名/xxx.h)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img@main/image-20250723115447540.png" alt="image-20250723115447540"></p>
<p>Python
需要调用的中间文件(…/工作空间/devel/lib/python3/dist-packages/包名/srv)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img@main/image-20250723115515055.png" alt="image-20250723115515055"></p>
<p>后续调用相关 srv 时，是从这些中间文件调用的</p>
<h3 id="服务通信基本操作">服务通信基本操作</h3>
<h4 id="服务端">服务端</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    需求: </span></span><br><span class="line"><span class="comment">        编写两个节点实现服务通信，客户端节点需要提交两个整数到服务器</span></span><br><span class="line"><span class="comment">        服务器需要解析客户端提交的数据，相加后，将结果响应回客户端，</span></span><br><span class="line"><span class="comment">        客户端再解析</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    服务器实现:</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.初始化 ROS 节点</span></span><br><span class="line"><span class="comment">        3.创建 ROS 句柄</span></span><br><span class="line"><span class="comment">        4.创建 服务 对象</span></span><br><span class="line"><span class="comment">        5.回调函数处理请求并产生响应</span></span><br><span class="line"><span class="comment">        6.由于请求有多个，需要调用 ros::spin()</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"test_server_client/AddInts.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// bool 返回值由于标志是否处理成功</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">doReq</span><span class="params">(test_server_client::AddInts::Request&amp; req,</span></span></span><br><span class="line"><span class="params"><span class="function">          test_server_client::AddInts::Response&amp; resp)</span></span>{</span><br><span class="line">    <span class="type">int</span> num1 = req.num1;</span><br><span class="line">    <span class="type">int</span> num2 = req.num2;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"服务器接收到的请求数据为:num1 = %d, num2 = %d"</span>,num1, num2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//逻辑处理</span></span><br><span class="line">    <span class="keyword">if</span> (num1 &lt; <span class="number">0</span> || num2 &lt; <span class="number">0</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">ROS_ERROR</span>(<span class="string">"提交的数据异常:数据不可以为负数"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果没有异常，那么相加并将结果赋值给 resp</span></span><br><span class="line">    resp.sum = num1 + num2;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    <span class="comment">// 2.初始化 ROS 节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"AddInts_Server"</span>);</span><br><span class="line">    <span class="comment">// 3.创建 ROS 句柄</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">// 4.创建 服务 对象</span></span><br><span class="line">    ros::ServiceServer server = nh.<span class="built_in">advertiseService</span>(<span class="string">"AddInts"</span>,doReq);</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"服务已经启动...."</span>);</span><br><span class="line">    <span class="comment">//     5.回调函数处理请求并产生响应</span></span><br><span class="line">    <span class="comment">//     6.由于请求有多个，需要调用 ros::spin()</span></span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="客户端">客户端</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    需求: </span></span><br><span class="line"><span class="comment">        编写两个节点实现服务通信，客户端节点需要提交两个整数到服务器</span></span><br><span class="line"><span class="comment">        服务器需要解析客户端提交的数据，相加后，将结果响应回客户端，</span></span><br><span class="line"><span class="comment">        客户端再解析</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    服务器实现:</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.初始化 ROS 节点</span></span><br><span class="line"><span class="comment">        3.创建 ROS 句柄</span></span><br><span class="line"><span class="comment">        4.创建 客户端 对象</span></span><br><span class="line"><span class="comment">        5.请求服务，接收响应</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 1.包含头文件</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"test_server_client/AddInts.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用时动态传值,如果通过 launch 的 args 传参，需要传递的参数个数 +3</span></span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">3</span>)</span><br><span class="line">    <span class="comment">// if (argc != 5)//launch 传参(0-文件路径 1传入的参数 2传入的参数 3节点名称 4日志路径)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">ROS_ERROR</span>(<span class="string">"请提交两个整数"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.初始化 ROS 节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"AddInts_Client"</span>);</span><br><span class="line">    <span class="comment">// 3.创建 ROS 句柄</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">// 4.创建 客户端 对象</span></span><br><span class="line">    ros::ServiceClient client = nh.<span class="built_in">serviceClient</span>&lt;test_server_client::AddInts&gt;(<span class="string">"AddInts"</span>);</span><br><span class="line">    <span class="comment">//等待服务启动成功</span></span><br><span class="line">    <span class="comment">//方式1</span></span><br><span class="line">    ros::service::<span class="built_in">waitForService</span>(<span class="string">"AddInts"</span>);</span><br><span class="line">    <span class="comment">//方式2</span></span><br><span class="line">    <span class="comment">// client.waitForExistence();</span></span><br><span class="line">    <span class="comment">// 5.组织请求数据</span></span><br><span class="line">    test_server_client::AddInts ai;</span><br><span class="line">    ai.request.num1 = <span class="built_in">atoi</span>(argv[<span class="number">1</span>]);</span><br><span class="line">    ai.request.num2 = <span class="built_in">atoi</span>(argv[<span class="number">2</span>]);</span><br><span class="line">    <span class="comment">// 6.发送请求,返回 bool 值，标记是否成功</span></span><br><span class="line">    <span class="type">bool</span> flag = client.<span class="built_in">call</span>(ai);</span><br><span class="line">    <span class="comment">// 7.处理响应</span></span><br><span class="line">    <span class="keyword">if</span> (flag)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">"请求正常处理,响应结果:%d"</span>,ai.response.sum);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">ROS_ERROR</span>(<span class="string">"请求处理失败...."</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="配置-cmakeliststxt">配置 CMakeLists.txt</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">add_executable(AddInts_Server src/AddInts_Server.cpp)</span><br><span class="line">add_executable(AddInts_Client src/AddInts_Client.cpp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add_dependencies(AddInts_Server ${PROJECT_NAME}_gencpp)</span><br><span class="line">add_dependencies(AddInts_Client ${PROJECT_NAME}_gencpp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">target_link_libraries(AddInts_Server</span><br><span class="line">  ${catkin_LIBRARIES}</span><br><span class="line">)</span><br><span class="line">target_link_libraries(AddInts_Client</span><br><span class="line">  ${catkin_LIBRARIES}</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="执行">执行</h4>
<p><strong>流程:</strong></p>
<ul>
<li>需要先启动服务:<code>rosrun 包名 服务</code></li>
<li>然后再调用客户端 :<code>rosrun 包名 客户端 参数1 参数2</code></li>
</ul>
<p><strong>结果:</strong></p>
<p>会根据提交的数据响应相加后的结果。</p>
<p><strong>注意:</strong></p>
<p>如果先启动客户端，那么会导致运行失败</p>
<p><strong>优化:</strong></p>
<p>在客户端发送请求前添加:<code>client.waitForExistence();</code></p>
<p>或:<code>ros::service::waitForService("AddInts");</code></p>
<p>这是一个阻塞式函数，只有服务启动成功后才会继续执行</p>
<p>此处可以使用 launch 文件优化，但是需要注意 args 传参特点</p>
<h2 id="参数服务器">参数服务器</h2>
<p>参数服务器实现是最为简单的，该模型如下图所示,该模型中涉及到三个角色:</p>
<ul>
<li>ROS Master (管理者)</li>
<li>Talker (参数设置者)</li>
<li>Listener (参数调用者)</li>
</ul>
<h3 id="理论模型-2">理论模型</h3>
<p>ROS Master 作为一个公共容器保存参数，Talker
可以向容器中设置参数，Listener 可以获取参数。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img@main/03ROS%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B603_%E5%8F%82%E6%95%B0%E6%9C%8D%E5%8A%A1%E5%99%A8.jpg" alt="img" style="zoom:50%;">

<p>整个流程由以下步骤实现:</p>
<ol type="1">
<li><strong>Talker 设置参数</strong> Talker 通过 RPC
向参数服务器发送参数(包括参数名与参数值)，ROS Master
将参数保存到参数列表中。</li>
<li><strong>Listener 获取参数</strong> Listener 通过 RPC
向参数服务器发送参数查找请求，请求中包含要查找的参数名。</li>
<li><strong>ROS Master 向 Listener 发送参数值</strong> ROS Master
根据步骤2请求提供的参数名查找参数值，并将查询结果通过 RPC 发送给
Listener。</li>
</ol>
<h3 id="参数可使用数据类型">参数可使用数据类型:</h3>
<ul>
<li>32-bit integers</li>
<li>booleans</li>
<li>strings</li>
<li>doubles</li>
<li>iso8601 dates</li>
<li>lists</li>
<li>base64-encoded binary data</li>
<li>字典</li>
</ul>
<p>注意:参数服务器不是为高性能而设计的，因此最好用于存储静态的非二进制的简单数据</p>
<h3 id="参数服务器基本操作">参数服务器基本操作</h3>
<p>**需求:**实现参数服务器参数的增删改查操作。</p>
<p>在 C++ 中实现参数服务器数据的增删改查，可以通过两套 API 实现:</p>
<ul>
<li>ros::NodeHandle</li>
<li>ros::param</li>
</ul>
<h4 id="参数服务器新增修改参数">参数服务器新增(修改)参数</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    参数服务器操作之新增与修改(二者API一样)_C++实现:</span></span><br><span class="line"><span class="comment">    在 roscpp 中提供了两套 API 实现参数操作</span></span><br><span class="line"><span class="comment">    ros::NodeHandle</span></span><br><span class="line"><span class="comment">        setParam("键",值)</span></span><br><span class="line"><span class="comment">    ros::param</span></span><br><span class="line"><span class="comment">        set("键","值")</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    示例:分别设置整形、浮点、字符串、bool、列表、字典等类型参数</span></span><br><span class="line"><span class="comment">        修改(相同的键，不同的值)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"set_update_param"</span>);</span><br><span class="line"></span><br><span class="line">    std::vector&lt;std::string&gt; stus;</span><br><span class="line">    stus.<span class="built_in">push_back</span>(<span class="string">"zhangsan"</span>);</span><br><span class="line">    stus.<span class="built_in">push_back</span>(<span class="string">"李四"</span>);</span><br><span class="line">    stus.<span class="built_in">push_back</span>(<span class="string">"王五"</span>);</span><br><span class="line">    stus.<span class="built_in">push_back</span>(<span class="string">"孙大脑袋"</span>);</span><br><span class="line"></span><br><span class="line">    std::map&lt;std::string,std::string&gt; friends;</span><br><span class="line">    friends[<span class="string">"guo"</span>] = <span class="string">"huang"</span>;</span><br><span class="line">    friends[<span class="string">"yuang"</span>] = <span class="string">"xiao"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//NodeHandle--------------------------------------------------------</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">"nh_int"</span>,<span class="number">10</span>); <span class="comment">//整型</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">"nh_double"</span>,<span class="number">3.14</span>); <span class="comment">//浮点型</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">"nh_bool"</span>,<span class="literal">true</span>); <span class="comment">//bool</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">"nh_string"</span>,<span class="string">"hello NodeHandle"</span>); <span class="comment">//字符串</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">"nh_vector"</span>,stus); <span class="comment">// vector</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">"nh_map"</span>,friends); <span class="comment">// map</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//修改演示(相同的键，不同的值)</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">"nh_int"</span>,<span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//param--------------------------------------------------------</span></span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">"param_int"</span>,<span class="number">20</span>);</span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">"param_double"</span>,<span class="number">3.14</span>);</span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">"param_string"</span>,<span class="string">"Hello Param"</span>);</span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">"param_bool"</span>,<span class="literal">false</span>);</span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">"param_vector"</span>,stus);</span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">"param_map"</span>,friends);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//修改演示(相同的键，不同的值)</span></span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">"param_int"</span>,<span class="number">20000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="参数服务器获取参数">参数服务器获取参数</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    参数服务器操作之查询_C++实现:</span></span><br><span class="line"><span class="comment">    在 roscpp 中提供了两套 API 实现参数操作</span></span><br><span class="line"><span class="comment">    ros::NodeHandle</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        param(键,默认值) </span></span><br><span class="line"><span class="comment">            存在，返回对应结果，否则返回默认值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        getParam(键,存储结果的变量)</span></span><br><span class="line"><span class="comment">            存在,返回 true,且将值赋值给参数2</span></span><br><span class="line"><span class="comment">            若果键不存在，那么返回值为 false，且不为参数2赋值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        getParamCached键,存储结果的变量)--提高变量获取效率</span></span><br><span class="line"><span class="comment">            存在,返回 true,且将值赋值给参数2</span></span><br><span class="line"><span class="comment">            若果键不存在，那么返回值为 false，且不为参数2赋值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        getParamNames(std::vector&lt;std::string&gt;)</span></span><br><span class="line"><span class="comment">            获取所有的键,并存储在参数 vector 中 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        hasParam(键)</span></span><br><span class="line"><span class="comment">            是否包含某个键，存在返回 true，否则返回 false</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        searchParam(参数1，参数2)</span></span><br><span class="line"><span class="comment">            搜索键，参数1是被搜索的键，参数2存储搜索结果的变量</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    ros::param ----- 与 NodeHandle 类似</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"get_param"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//NodeHandle--------------------------------------------------------</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    ros::NodeHandle nh;</span></span><br><span class="line"><span class="comment">    // param 函数</span></span><br><span class="line"><span class="comment">    int res1 = nh.param("nh_int",100); // 键存在</span></span><br><span class="line"><span class="comment">    int res2 = nh.param("nh_int2",100); // 键不存在</span></span><br><span class="line"><span class="comment">    ROS_INFO("param获取结果:%d,%d",res1,res2);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    // getParam 函数</span></span><br><span class="line"><span class="comment">    int nh_int_value;</span></span><br><span class="line"><span class="comment">    double nh_double_value;</span></span><br><span class="line"><span class="comment">    bool nh_bool_value;</span></span><br><span class="line"><span class="comment">    std::string nh_string_value;</span></span><br><span class="line"><span class="comment">    std::vector&lt;std::string&gt; stus;</span></span><br><span class="line"><span class="comment">    std::map&lt;std::string, std::string&gt; friends;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    nh.getParam("nh_int",nh_int_value);</span></span><br><span class="line"><span class="comment">    nh.getParam("nh_double",nh_double_value);</span></span><br><span class="line"><span class="comment">    nh.getParam("nh_bool",nh_bool_value);</span></span><br><span class="line"><span class="comment">    nh.getParam("nh_string",nh_string_value);</span></span><br><span class="line"><span class="comment">    nh.getParam("nh_vector",stus);</span></span><br><span class="line"><span class="comment">    nh.getParam("nh_map",friends);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    ROS_INFO("getParam获取的结果:%d,%.2f,%s,%d",</span></span><br><span class="line"><span class="comment">            nh_int_value,</span></span><br><span class="line"><span class="comment">            nh_double_value,</span></span><br><span class="line"><span class="comment">            nh_string_value.c_str(),</span></span><br><span class="line"><span class="comment">            nh_bool_value</span></span><br><span class="line"><span class="comment">            );</span></span><br><span class="line"><span class="comment">    for (auto &amp;&amp;stu : stus)</span></span><br><span class="line"><span class="comment">    {</span></span><br><span class="line"><span class="comment">        ROS_INFO("stus 元素:%s",stu.c_str());        </span></span><br><span class="line"><span class="comment">    }</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    for (auto &amp;&amp;f : friends)</span></span><br><span class="line"><span class="comment">    {</span></span><br><span class="line"><span class="comment">        ROS_INFO("map 元素:%s = %s",f.first.c_str(), f.second.c_str());</span></span><br><span class="line"><span class="comment">    }</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    // getParamCached()</span></span><br><span class="line"><span class="comment">    nh.getParamCached("nh_int",nh_int_value);</span></span><br><span class="line"><span class="comment">    ROS_INFO("通过缓存获取数据:%d",nh_int_value);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    //getParamNames()</span></span><br><span class="line"><span class="comment">    std::vector&lt;std::string&gt; param_names1;</span></span><br><span class="line"><span class="comment">    nh.getParamNames(param_names1);</span></span><br><span class="line"><span class="comment">    for (auto &amp;&amp;name : param_names1)</span></span><br><span class="line"><span class="comment">    {</span></span><br><span class="line"><span class="comment">        ROS_INFO("名称解析name = %s",name.c_str());        </span></span><br><span class="line"><span class="comment">    }</span></span><br><span class="line"><span class="comment">    ROS_INFO("----------------------------");</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    ROS_INFO("存在 nh_int 吗? %d",nh.hasParam("nh_int"));</span></span><br><span class="line"><span class="comment">    ROS_INFO("存在 nh_intttt 吗? %d",nh.hasParam("nh_intttt"));</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    std::string key;</span></span><br><span class="line"><span class="comment">    nh.searchParam("nh_int",key);</span></span><br><span class="line"><span class="comment">    ROS_INFO("搜索键:%s",key.c_str());</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">//param--------------------------------------------------------</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"++++++++++++++++++++++++++++++++++++++++"</span>);</span><br><span class="line">    <span class="type">int</span> res3 = ros::param::<span class="built_in">param</span>(<span class="string">"param_int"</span>,<span class="number">20</span>); <span class="comment">//存在</span></span><br><span class="line">    <span class="type">int</span> res4 = ros::param::<span class="built_in">param</span>(<span class="string">"param_int2"</span>,<span class="number">20</span>); <span class="comment">// 不存在返回默认</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"param获取结果:%d,%d"</span>,res3,res4);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getParam 函数</span></span><br><span class="line">    <span class="type">int</span> param_int_value;</span><br><span class="line">    <span class="type">double</span> param_double_value;</span><br><span class="line">    <span class="type">bool</span> param_bool_value;</span><br><span class="line">    std::string param_string_value;</span><br><span class="line">    std::vector&lt;std::string&gt; param_stus;</span><br><span class="line">    std::map&lt;std::string, std::string&gt; param_friends;</span><br><span class="line"></span><br><span class="line">    ros::param::<span class="built_in">get</span>(<span class="string">"param_int"</span>,param_int_value);</span><br><span class="line">    ros::param::<span class="built_in">get</span>(<span class="string">"param_double"</span>,param_double_value);</span><br><span class="line">    ros::param::<span class="built_in">get</span>(<span class="string">"param_bool"</span>,param_bool_value);</span><br><span class="line">    ros::param::<span class="built_in">get</span>(<span class="string">"param_string"</span>,param_string_value);</span><br><span class="line">    ros::param::<span class="built_in">get</span>(<span class="string">"param_vector"</span>,param_stus);</span><br><span class="line">    ros::param::<span class="built_in">get</span>(<span class="string">"param_map"</span>,param_friends);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"getParam获取的结果:%d,%.2f,%s,%d"</span>,</span><br><span class="line">            param_int_value,</span><br><span class="line">            param_double_value,</span><br><span class="line">            param_string_value.<span class="built_in">c_str</span>(),</span><br><span class="line">            param_bool_value</span><br><span class="line">            );</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;&amp;stu : param_stus)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">"stus 元素:%s"</span>,stu.<span class="built_in">c_str</span>());        </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;&amp;f : param_friends)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">"map 元素:%s = %s"</span>,f.first.<span class="built_in">c_str</span>(), f.second.<span class="built_in">c_str</span>());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getParamCached()</span></span><br><span class="line">    ros::param::<span class="built_in">getCached</span>(<span class="string">"param_int"</span>,param_int_value);</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"通过缓存获取数据:%d"</span>,param_int_value);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//getParamNames()</span></span><br><span class="line">    std::vector&lt;std::string&gt; param_names2;</span><br><span class="line">    ros::param::<span class="built_in">getParamNames</span>(param_names2);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;&amp;name : param_names2)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">"名称解析name = %s"</span>,name.<span class="built_in">c_str</span>());        </span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"----------------------------"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"存在 param_int 吗? %d"</span>,ros::param::<span class="built_in">has</span>(<span class="string">"param_int"</span>));</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"存在 param_intttt 吗? %d"</span>,ros::param::<span class="built_in">has</span>(<span class="string">"param_intttt"</span>));</span><br><span class="line"></span><br><span class="line">    std::string key;</span><br><span class="line">    ros::param::<span class="built_in">search</span>(<span class="string">"param_int"</span>,key);</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"搜索键:%s"</span>,key.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="参数服务器删除参数">参数服务器删除参数</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    参数服务器操作之删除_C++实现:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    ros::NodeHandle</span></span><br><span class="line"><span class="comment">        deleteParam("键")</span></span><br><span class="line"><span class="comment">        根据键删除参数，删除成功，返回 true，否则(参数不存在)，返回 false</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    ros::param</span></span><br><span class="line"><span class="comment">        del("键")</span></span><br><span class="line"><span class="comment">        根据键删除参数，删除成功，返回 true，否则(参数不存在)，返回 false</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{   </span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"delete_param"</span>);</span><br><span class="line"></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="type">bool</span> r1 = nh.<span class="built_in">deleteParam</span>(<span class="string">"nh_int"</span>);</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"nh 删除结果:%d"</span>,r1);</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> r2 = ros::param::<span class="built_in">del</span>(<span class="string">"param_int"</span>);</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"param 删除结果:%d"</span>,r2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="通信机制比较">通信机制比较</h2>
<p>三种通信机制中，参数服务器是一种数据共享机制，可以在不同的节点之间共享数据，话题通信与服务通信是在不同的节点之间传递数据的，三者是ROS中最基础也是应用最为广泛的通信机制。</p>
<p>这其中，话题通信和服务通信有一定的相似性也有本质上的差异，在此将二者做一下简单比较:</p>
<p>二者的实现流程是比较相似的，都是涉及到四个要素:</p>
<ul>
<li>要素1: 消息的发布方/客户端(Publisher/Client)</li>
<li>要素2: 消息的订阅方/服务端(Subscriber/Server)</li>
<li>要素3: 话题名称(Topic/Service)</li>
<li>要素4: 数据载体(msg/srv)</li>
</ul>
<p>可以概括为:
两个节点通过话题关联到一起，并使用某种类型的数据载体实现数据传输。</p>
<p>二者的实现也是有本质差异的，具体比较如下:</p>
<table>
<thead>
<tr>
<th style="text-align: left;"></th>
<th style="text-align: left;">Topic(话题)</th>
<th style="text-align: left;">Service(服务)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">通信模式</td>
<td style="text-align: left;">发布/订阅</td>
<td style="text-align: left;">请求/响应</td>
</tr>
<tr>
<td style="text-align: left;">同步性</td>
<td style="text-align: left;">异步</td>
<td style="text-align: left;">同步</td>
</tr>
<tr>
<td style="text-align: left;">底层协议</td>
<td style="text-align: left;">ROSTCP/ROSUDP</td>
<td style="text-align: left;">ROSTCP/ROSUDP</td>
</tr>
<tr>
<td style="text-align: left;">缓冲区</td>
<td style="text-align: left;">有</td>
<td style="text-align: left;">无</td>
</tr>
<tr>
<td style="text-align: left;">实时性</td>
<td style="text-align: left;">弱</td>
<td style="text-align: left;">强</td>
</tr>
<tr>
<td style="text-align: left;">节点关系</td>
<td style="text-align: left;">多对多</td>
<td style="text-align: left;">一对多(一个 Server)</td>
</tr>
<tr>
<td style="text-align: left;">通信数据</td>
<td style="text-align: left;">msg</td>
<td style="text-align: left;">srv</td>
</tr>
<tr>
<td style="text-align: left;">使用场景</td>
<td style="text-align: left;">连续高频的数据发布与接收:雷达、里程计</td>
<td style="text-align: left;">偶尔调用或执行某一项特定功能：拍照、语音识别</td>
</tr>
</tbody>
</table>
<p>不同通信机制有一定的互补性，都有各自适应的应用场景。尤其是话题与服务通信，需要结合具体的应用场景与二者的差异，选择合适的通信机制。</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img/202504142042655.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img/202504142042655.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">Bohao Zhao</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://bohaoblog.top/posts/4d8d4c8f.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://bohaoblog.top/posts/4d8d4c8f.html')">ROS学习笔记二_通信机制</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img/202504161847401.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img/202504161847401.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img/202504161847176.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img/202504161847176.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://bohaoblog.top/posts/4d8d4c8f.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=ROS学习笔记二_通信机制&amp;url=https://bohaoblog.top/posts/4d8d4c8f.html&amp;pic=https://cdn.jsdelivr.net/gh/zhaobohao-byte/img@main/01%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%9E%8B.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://bohaoblog.top" target="_blank">苛苛浩</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E6%9C%BA%E5%99%A8%E4%BA%BA-ROS/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>机器人 ROS<span class="tagsPageCount">3</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img@main/20250919231133280.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/f193c0bd.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img@main/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ROS学习笔记一_基础知识</div></div></a></div><div class="next-post pull-right"><a href="/posts/54708efa.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img@main/20250919223252326.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ROS学习笔记三_通信机制进阶</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/f193c0bd.html" title="ROS学习笔记一_基础知识"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img@main/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-28</div><div class="title">ROS学习笔记一_基础知识</div></div></a></div><div><a href="/posts/54708efa.html" title="ROS学习笔记三_通信机制进阶"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img@main/20250919223252326.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-28</div><div class="title">ROS学习笔记三_通信机制进阶</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img/202504142042655.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img/202504151949684.png" alt="status"/></div></div><div class="author-info__description">我还没写描述呢~</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Bohao Zhao</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/zhaobohao-byte" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/435548077" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来看我的博客鸭~</div></div><div class="card-widget card-countdown"><div class="item-headline"><i></i><span></span></div><div class="item-content"><div class="cd-count-left">
  <span class="cd-text">距离</span>
  <span class="cd-name" id="eventName"></span>
  <span class="cd-time" id="daysUntil"></span>
  <span class="cd-date" id="eventDate"></span>
</div>
<div id="countRight" class="cd-count-right"></div>
</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ros-%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6"><span class="toc-number">1.</span> <span class="toc-text">ROS 通信机制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1"><span class="toc-number">1.1.</span> <span class="toc-text">话题通信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8"><span class="toc-number">1.1.2.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%90%86%E8%AE%BA%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.1.3.</span> <span class="toc-text">理论模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.1.4.</span> <span class="toc-text">话题通信基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E8%80%85%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">发布者代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E6%96%B9"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">订阅方</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEcmakelisttext"><span class="toc-number">1.1.4.3.</span> <span class="toc-text">配置CMakeList.text</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E4%BF%A1msg%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.5.</span> <span class="toc-text">通信msg文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89msg%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.5.1.</span> <span class="toc-text">定义msg文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.5.2.</span> <span class="toc-text">编辑配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%AF%91"><span class="toc-number">1.1.5.3.</span> <span class="toc-text">编译</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E9%80%9A%E4%BF%A1"><span class="toc-number">1.2.</span> <span class="toc-text">服务通信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%90%86%E8%AE%BA%E6%A8%A1%E5%9E%8B-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">理论模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1srv%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.2.</span> <span class="toc-text">服务srv文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89srv%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">定义srv文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-1"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">编辑配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%AF%91-1"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">编译</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E9%80%9A%E4%BF%A1%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.3.</span> <span class="toc-text">服务通信基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">服务端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">客户端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-cmakeliststxt"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">配置 CMakeLists.txt</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">执行</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.3.</span> <span class="toc-text">参数服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%90%86%E8%AE%BA%E6%A8%A1%E5%9E%8B-2"><span class="toc-number">1.3.1.</span> <span class="toc-text">理论模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%8F%AF%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.2.</span> <span class="toc-text">参数可使用数据类型:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.3.3.</span> <span class="toc-text">参数服务器基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%96%B0%E5%A2%9E%E4%BF%AE%E6%94%B9%E5%8F%82%E6%95%B0"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">参数服务器新增(修改)参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">参数服务器获取参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%88%A0%E9%99%A4%E5%8F%82%E6%95%B0"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">参数服务器删除参数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%E6%AF%94%E8%BE%83"><span class="toc-number">1.4.</span> <span class="toc-text">通信机制比较</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/1e92532b.html" title="PPO算法-chapter3-贝尔曼最优方程"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img@main/20250919231133280.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="PPO算法-chapter3-贝尔曼最优方程"/></a><div class="content"><a class="title" href="/posts/1e92532b.html" title="PPO算法-chapter3-贝尔曼最优方程">PPO算法-chapter3-贝尔曼最优方程</a><time datetime="2025-09-19T15:14:27.000Z" title="发表于 2025-09-19 23:14:27">2025-09-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/f3b61b38.html" title="PPO算法-chapter1-基础原理"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img@main/20250919221736686.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="PPO算法-chapter1-基础原理"/></a><div class="content"><a class="title" href="/posts/f3b61b38.html" title="PPO算法-chapter1-基础原理">PPO算法-chapter1-基础原理</a><time datetime="2025-09-19T14:26:46.000Z" title="发表于 2025-09-19 22:26:46">2025-09-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/43d591d2.html" title="PPO算法-chapter8-值函数近似和DQN"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img@main/20250919232306587.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="PPO算法-chapter8-值函数近似和DQN"/></a><div class="content"><a class="title" href="/posts/43d591d2.html" title="PPO算法-chapter8-值函数近似和DQN">PPO算法-chapter8-值函数近似和DQN</a><time datetime="2025-09-19T07:32:20.000Z" title="发表于 2025-09-19 15:32:20">2025-09-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/6dc48cfa.html" title="PPO算法-chapter9-演员评论家方法"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img@main/20250919233050694.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="PPO算法-chapter9-演员评论家方法"/></a><div class="content"><a class="title" href="/posts/6dc48cfa.html" title="PPO算法-chapter9-演员评论家方法">PPO算法-chapter9-演员评论家方法</a><time datetime="2025-09-19T07:32:20.000Z" title="发表于 2025-09-19 15:32:20">2025-09-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/791dad92.html" title="PPO算法-chapter4-值迭代和策略迭代"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhaobohao-byte/img@main/20250919231945367.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="PPO算法-chapter4-值迭代和策略迭代"/></a><div class="content"><a class="title" href="/posts/791dad92.html" title="PPO算法-chapter4-值迭代和策略迭代">PPO算法-chapter4-值迭代和策略迭代</a><time datetime="2025-09-19T07:32:20.000Z" title="发表于 2025-09-19 15:32:20">2025-09-19</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-上班摸鱼中.svg" alt="又是呆在工位搬弄好玩的一天~" title="又是呆在工位搬弄好玩的一天~"/><div id="runtimeTextTip"></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2025 By <a class="footer-bar-link" href="/" title="Bohao Zhao" target="_blank">Bohao Zhao</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  getScript('https://sdk.jinrishici.com/v2/browser/jinrishici.js').then(() => {
    jinrishici.load(result =>{
      if (true) {
        const sub = ["天下事,皆为利"]
        const content = result.data.content
        sub.unshift(content)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = result.data.content
      }
    })
  })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">24</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">6</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://bohaoblog.top/" title="个人主页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="个人主页"/><span class="back-menu-item-text">个人主页</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CMake/" style="font-size: 0.88rem;">CMake<sup>1</sup></a><a href="/tags/IEEE/" style="font-size: 0.88rem;">IEEE<sup>1</sup></a><a href="/tags/latex/" style="font-size: 0.88rem;">latex<sup>1</sup></a><a href="/tags/%E5%80%BC%E5%87%BD%E6%95%B0%E8%BF%91%E4%BC%BC%E5%92%8CDQN/" style="font-size: 0.88rem;">值函数近似和DQN<sup>1</sup></a><a href="/tags/%E5%80%BC%E8%BF%AD%E4%BB%A3%E5%92%8C%E7%AD%96%E7%95%A5%E8%BF%AD%E4%BB%A3/" style="font-size: 0.88rem;">值迭代和策略迭代<sup>1</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E5%8E%9F%E7%90%86/" style="font-size: 0.88rem;">基础原理<sup>1</sup></a><a href="/tags/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0-%E6%9C%BA%E5%99%A8%E4%BA%BA-ROS/" style="font-size: 0.88rem;">强化学习 机器人 ROS<sup>1</sup></a><a href="/tags/%E6%8E%A7%E5%88%B6%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">控制算法<sup>1</sup></a><a href="/tags/%E6%96%87%E6%9C%AC/" style="font-size: 0.88rem;">文本<sup>1</sup></a><a href="/tags/%E6%96%87%E7%8C%AE%E7%AE%A1%E7%90%86/" style="font-size: 0.88rem;">文献管理<sup>2</sup></a><a href="/tags/%E6%97%B6%E5%BA%8F%E5%B7%AE%E5%88%86%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">时序差分算法<sup>1</sup></a><a href="/tags/%E6%9C%BA%E5%99%A8%E4%BA%BA/" style="font-size: 0.88rem;">机器人<sup>1</sup></a><a href="/tags/%E6%9C%BA%E5%99%A8%E4%BA%BA-ROS/" style="font-size: 0.88rem;">机器人 ROS<sup>3</sup></a><a href="/tags/%E6%BC%94%E5%91%98%E8%AF%84%E8%AE%BA%E5%AE%B6%E6%96%B9%E6%B3%95/" style="font-size: 0.88rem;">演员评论家方法<sup>1</sup></a><a href="/tags/%E7%AD%89%E4%BB%B7%E8%BE%93%E5%85%A5%E5%B9%B2%E6%89%B0/" style="font-size: 0.88rem;">等价输入干扰<sup>2</sup></a><a href="/tags/%E7%AD%96%E7%95%A5%E6%A2%AF%E5%BA%A6%E6%96%B9%E6%B3%95/" style="font-size: 0.88rem;">策略梯度方法<sup>1</sup></a><a href="/tags/%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E6%96%B9%E6%B3%95/" style="font-size: 0.88rem;">蒙特卡洛方法<sup>1</sup></a><a href="/tags/%E8%B4%9D%E5%B0%94%E6%9B%BC%E6%96%B9%E7%A8%8B/" style="font-size: 0.88rem;">贝尔曼方程<sup>1</sup></a><a href="/tags/%E8%B4%9D%E5%B0%94%E6%9B%BC%E6%9C%80%E4%BC%98%E6%96%B9%E7%A8%8B/" style="font-size: 0.88rem;">贝尔曼最优方程<sup>1</sup></a><a href="/tags/%E9%9A%8F%E6%9C%BA%E8%BF%91%E4%BC%BC%E7%90%86%E8%AE%BA%E5%92%8C%E9%9A%8F%E6%9C%BA%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D/" style="font-size: 0.88rem;">随机近似理论和随机梯度下降<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/15/2025 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2025 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Bohao Zhao 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("04/15/2025 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-下班啦.svg";
        img.title = "下班了就去玩三角洲咯，嘿嘿~";
        img.alt = "下班了就去玩三角洲咯，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.cbd.int/mathjax@3.2.2/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.bohaoblog.top',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.bohaoblog.top',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.bohaoblog.top',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script src="/custom/js/countdown.js"></script><div class="aplayer no-destroy" data-id="8152976493" data-server="netease" data-type="playlist" data-order="list" data-fixed="true" data-preload="auto" data-autoplay="false" data-mutex="true" ></div><script id="click-show-text" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="okk,yeah,soga" data-fontsize="15px" data-random="true" async="async"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":200,"height":400},"mobile":{"show":false},"log":false});</script></body></html>